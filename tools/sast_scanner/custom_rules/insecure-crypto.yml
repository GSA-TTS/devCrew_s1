rules:
  - id: weak-hash-md5
    pattern-either:
      - pattern: hashlib.md5(...)
      - pattern: crypto.createHash("md5")
      - pattern: MessageDigest.getInstance("MD5")
    message: |
      MD5 is a weak hash function and should not be used for security purposes.
      Use SHA-256 or stronger cryptographic hash functions.

      Example:
        # Bad
        hash = hashlib.md5(data).hexdigest()

        # Good
        hash = hashlib.sha256(data).hexdigest()
    languages: [python, javascript, typescript, java]
    severity: ERROR
    metadata:
      category: security
      cwe:
        - "CWE-327"
      owasp:
        - "A02:2021-Cryptographic Failures"
      confidence: HIGH
      references:
        - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/04-Testing_for_Weak_Encryption

  - id: weak-hash-sha1
    pattern-either:
      - pattern: hashlib.sha1(...)
      - pattern: crypto.createHash("sha1")
      - pattern: MessageDigest.getInstance("SHA-1")
    message: |
      SHA-1 is deprecated and should not be used for security-critical operations.
      Use SHA-256 or SHA-3 instead.

      Example:
        # Bad
        hash = hashlib.sha1(data).hexdigest()

        # Good
        hash = hashlib.sha256(data).hexdigest()
    languages: [python, javascript, typescript, java]
    severity: WARNING
    metadata:
      category: security
      cwe:
        - "CWE-327"
      owasp:
        - "A02:2021-Cryptographic Failures"
      confidence: HIGH

  - id: insecure-random
    pattern-either:
      - pattern: random.random()
      - pattern: Math.random()
      - pattern: new Random()
    message: |
      Using insecure random number generator for security purposes.
      Use cryptographically secure random generators.

      Example:
        # Python - Bad
        import random
        token = random.randint(1000, 9999)

        # Python - Good
        import secrets
        token = secrets.randbelow(10000)

        # JavaScript - Bad
        const token = Math.random()

        # JavaScript - Good
        const token = crypto.getRandomValues(new Uint32Array(1))[0]
    languages: [python, javascript, typescript, java]
    severity: ERROR
    metadata:
      category: security
      cwe:
        - "CWE-330"
      owasp:
        - "A02:2021-Cryptographic Failures"
      confidence: MEDIUM

  - id: hardcoded-encryption-key
    pattern-either:
      - pattern: AES.new($KEY, ...)
      - pattern: cipher.init(..., "...")
      - pattern: crypto.createCipher(..., "...")
    message: |
      Hardcoded encryption key detected. Encryption keys should be stored
      securely and never hardcoded in source code.

      Example:
        # Bad
        cipher = AES.new(b"sixteen byte key", AES.MODE_ECB)

        # Good
        key = os.environ["ENCRYPTION_KEY"].encode()
        cipher = AES.new(key, AES.MODE_GCM)
    languages: [python, javascript, typescript, java]
    severity: ERROR
    metadata:
      category: security
      cwe:
        - "CWE-321"
      owasp:
        - "A02:2021-Cryptographic Failures"
      confidence: HIGH
