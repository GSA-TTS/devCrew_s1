# Vulnerability Management Platform

TOOL-SEC-004: Comprehensive vulnerability aggregation, scoring, and remediation tracking for devCrew_s1.

## Features

- **Vulnerability Aggregation**: Parse and normalize vulnerability reports from multiple formats (SARIF, JSON, XML)
- **Risk Scoring**: CVSS 3.1 calculation with base, temporal, and environmental scores
- **Deduplication**: Fingerprint-based vulnerability deduplication
- **Remediation Tracking**: Full workflow management with status transitions, assignees, and SLA monitoring
- **Compliance Reporting**: OWASP Top 10, CWE Top 25, and PCI DSS v4.0 mapping
- **Trend Analysis**: MTTR calculation, security debt tracking, and forecasting
- **DefectDojo Integration**: API client for external vulnerability management platform

## Installation

```bash
cd tools/vulnerability_management
pip install -r requirements.txt
```

## Quick Start

### Import Vulnerabilities

```python
from vulnerability_management import VulnerabilityAggregator

aggregator = VulnerabilityAggregator()
vulns = aggregator.parse_sarif("scan_results.sarif")
print(f"Imported {len(vulns)} vulnerabilities")
print(aggregator.statistics())
```

### Score and Prioritize

```python
from vulnerability_management import RiskScorer, CVSSVector

scorer = RiskScorer()

# Calculate CVSS from vector
vector = CVSSVector.from_vector_string("CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H")
score = scorer.calculate_base_score(vector)
print(f"CVSS Score: {score}")

# Prioritize vulnerabilities
prioritized = scorer.prioritize(vulns)
```

### Track Remediation

```python
from vulnerability_management import RemediationTracker, RemediationStatus

tracker = RemediationTracker()

# Create tasks with SLA-based due dates
for vuln in vulns:
    task = tracker.create_task(vuln, assignee="security-team@example.com")

# Transition status
tracker.transition(task.task_id, RemediationStatus.IN_PROGRESS)
tracker.transition(task.task_id, RemediationStatus.IN_REVIEW)
tracker.transition(task.task_id, RemediationStatus.RESOLVED)

# Check SLA compliance
print(tracker.sla_report())
```

### Generate Compliance Reports

```python
from vulnerability_management import ComplianceReporter

reporter = ComplianceReporter()

# Generate reports
owasp_report = reporter.generate_owasp_report(vulns)
cwe_report = reporter.generate_cwe_report(vulns)
pci_report = reporter.generate_pci_dss_report(vulns)
summary = reporter.generate_executive_summary(vulns)

# Export
reporter.export_report(summary, "compliance_report.json")
```

### Analyze Trends

```python
from vulnerability_management import TrendAnalyzer

analyzer = TrendAnalyzer()

# Record snapshots over time
analyzer.record_snapshot(vulns, tracker.tasks)

# Calculate metrics
mttr = analyzer.calculate_mttr(tracker.tasks)
debt = analyzer.calculate_security_debt(vulns, tracker.tasks)
report = analyzer.generate_metrics_report(vulns, tracker.tasks)
```

## CLI Usage

```bash
# Import vulnerabilities
python -m vulnerability_management.vuln_cli import scan.sarif --format sarif -o vulns.json

# Score and prioritize
python -m vulnerability_management.vuln_cli score vulns.json --prioritize

# Assign for remediation
python -m vulnerability_management.vuln_cli assign vulns.json -a dev@example.com --severity high -o tasks.json

# Generate compliance report
python -m vulnerability_management.vuln_cli report vulns.json --framework owasp -o owasp_report.json

# Track remediation
python -m vulnerability_management.vuln_cli track tasks.json --action status
python -m vulnerability_management.vuln_cli track tasks.json --action sla
```

## Supported Formats

### Input Formats

- **SARIF**: Static Analysis Results Interchange Format (CodeQL, Semgrep, etc.)
- **JSON**: Generic vulnerability list or object with `vulnerabilities` key
- **XML**: OWASP ZAP, Nessus-style formats

### Compliance Frameworks

- OWASP Top 10 2021
- CWE Top 25 2023
- PCI DSS v4.0

## CVSS 3.1 Support

Full CVSS 3.1 implementation including:
- Base metrics (AV, AC, PR, UI, S, C, I, A)
- Temporal metrics (E, RL, RC)
- Environmental metrics (CR, IR, AR)

## Remediation Workflow

Valid status transitions:

```
OPEN -> IN_PROGRESS | ACCEPTED_RISK | FALSE_POSITIVE
IN_PROGRESS -> IN_REVIEW | OPEN
IN_REVIEW -> RESOLVED | IN_PROGRESS
RESOLVED -> REOPENED
ACCEPTED_RISK -> OPEN
FALSE_POSITIVE -> OPEN
REOPENED -> IN_PROGRESS | ACCEPTED_RISK
```

## Default SLA by Severity

| Severity | Days to Remediate |
|----------|-------------------|
| Critical | 7 |
| High | 30 |
| Medium | 90 |
| Low | 180 |
| Info | 365 |

## Running Tests

```bash
cd tools/vulnerability_management
python -m pytest test_vulnerability.py -v --cov=. --cov-report=term-missing
```

## API Reference

### VulnerabilityAggregator

- `parse_sarif(file_path)` - Parse SARIF format
- `parse_json(file_path)` - Parse JSON format
- `parse_xml(file_path)` - Parse XML format
- `deduplicate()` - Return count after deduplication
- `get_by_severity(severity)` - Filter by severity
- `export_json(file_path)` - Export to JSON
- `statistics()` - Get aggregated statistics

### RiskScorer

- `calculate_base_score(vector)` - Calculate CVSS 3.1 base score
- `calculate_temporal_score(base_score, vector)` - Calculate temporal score
- `calculate_environmental_score(vector)` - Calculate environmental score
- `score_vulnerability(vuln, vector)` - Score a vulnerability
- `prioritize(vulns, weights)` - Prioritize vulnerability list
- `get_risk_summary(vulns)` - Get risk statistics

### RemediationTracker

- `create_task(vuln, assignee, due_date)` - Create remediation task
- `transition(task_id, new_status, note)` - Change task status
- `assign(task_id, assignee, note)` - Assign task
- `get_overdue()` - Get overdue tasks
- `sla_report()` - Generate SLA compliance report

### ComplianceReporter

- `map_vulnerability(vuln)` - Map to compliance frameworks
- `generate_owasp_report(vulns)` - Generate OWASP Top 10 report
- `generate_cwe_report(vulns)` - Generate CWE Top 25 report
- `generate_pci_dss_report(vulns)` - Generate PCI DSS report
- `generate_executive_summary(vulns)` - Generate executive summary

### TrendAnalyzer

- `record_snapshot(vulns, tasks, timestamp)` - Record historical data
- `calculate_mttr(tasks, severity)` - Calculate Mean Time To Remediation
- `calculate_security_debt(vulns, tasks)` - Calculate security debt
- `get_trend(period_days)` - Get trend analysis
- `generate_metrics_report(vulns, tasks)` - Generate comprehensive metrics

## License

Part of devCrew_s1 project.
